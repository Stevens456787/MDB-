<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User and Location Manager</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React and ReactDOM CDNs -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.development.js"></script>
  <!-- Babel CDN for JSX support -->
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.5/babel.min.js"></script>
</head>
<body class="bg-gray-100">
  <div id="root" class="container mx-auto p-4"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function App() {
      // State for users and locations
      const [users, setUsers] = useState([]);
      const [locations, setLocations] = useState([]);
      const [error, setError] = useState(null);

      // State for user form
      const [userForm, setUserForm] = useState({
        name: '',
        email: '',
        password: '',
        phoneNumber: '',
        address: ''
      });

      // State for location form
      const [locationForm, setLocationForm] = useState({
        name: '',
        address: '',
        coordinates: { lat: '', lng: '' }
      });

      // Fetch users and locations on component mount
      useEffect(() => {
        fetchUsers();
        fetchLocations();
      }, []);

      // Fetch all users
      const fetchUsers = async () => {
        try {
          const response = await fetch('http://localhost:5000/api/users');
          const data = await response.json();
          setUsers(data);
        } catch (err) {
          setError('Failed to fetch users');
        }
      };

      // Fetch all locations
      const fetchLocations = async () => {
        try {
          const response = await fetch('http://localhost:5000/api/locations');
          const data = await response.json();
          setLocations(data);
        } catch (err) {
          setError('Failed to fetch locations');
        }
      };

      // Handle user form input changes
      const handleUserChange = (e) => {
        setUserForm({ ...userForm, [e.target.name]: e.target.value });
      };

      // Handle location form input changes
      const handleLocationChange = (e) => {
        const { name, value } = e.target;
        if (name === 'lat' || name === 'lng') {
          setLocationForm({
            ...locationForm,
            coordinates: { ...locationForm.coordinates, [name]: value }
          });
        } else {
          setLocationForm({ ...locationForm, [name]: value });
        }
      };

      // Handle user form submission
      const handleUserSubmit = async (e) => {
        e.preventDefault();
        try {
          const response = await fetch('http://localhost:5000/api/users', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(userForm),
          });
          if (response.ok) {
            await fetchUsers(); // Refresh user list
            setUserForm({ name: '', email: '', password: '', phoneNumber: '', address: '' }); // Reset form
          } else {
            setError('Failed to add user');
          }
        } catch (err) {
          setError('Error adding user');
        }
      };

      // Handle location form submission
      const handleLocationSubmit = async (e) => {
        e.preventDefault();
        const payload = {
          name: locationForm.name,
          address: locationForm.address,
          coordinates: {
            lat: parseFloat(locationForm.coordinates.lat),
            lng: parseFloat(locationForm.coordinates.lng),
          },
        };
        if (!payload.coordinates.lat || !payload.coordinates.lng) {
          delete payload.coordinates; // Remove coordinates if not provided
        }
        try {
          const response = await fetch('http://localhost:5000/api/locations', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
          });
          if (response.ok) {
            await fetchLocations(); // Refresh location list
            setLocationForm({ name: '', address: '', coordinates: { lat: '', lng: '' } }); // Reset form
          } else {
            setError('Failed to add location');
          }
        } catch (err) {
          setError('Error adding location');
        }
      };

      return (
        <div className="space-y-8">
          <h1 className="text-3xl font-bold text-center">User and Location Manager</h1>

          {error && <div className="text-red-500 text-center">{error}</div>}

          {/* User Form */}
          <div className="bg-white p-6 rounded-lg shadow-md">
            <h2 className="text-2xl font-semibold mb-4">Add New User</h2>
            <div onSubmit={handleUserSubmit} className="space-y-4">
              <input
                type="text"
                name="name"
                value={userForm.name}
                onChange={handleUserChange}
                placeholder="Name"
                className="w-full p-2 border rounded"
                required
              />
              <input
                type="email"
                name="email"
                value={userForm.email}
                onChange={handleUserChange}
                placeholder="Email"
                className="w-full p-2 border rounded"
                required
              />
              <input
                type="password"
                name="password"
                value={userForm.password}
                onChange={handleUserChange}
                placeholder="Password"
                className="w-full p-2 border rounded"
                required
              />
              <input
                type="text"
                name="phoneNumber"
                value={userForm.phoneNumber}
                onChange={handleUserChange}
                placeholder="Phone Number"
                className="w-full p-2 border rounded"
              />
              <input
                type="text"
                name="address"
                value={userForm.address}
                onChange={handleUserChange}
                placeholder="Address"
                className="w-full p-2 border rounded"
              />
              <button
                onClick={handleUserSubmit}
                className="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600"
              >
                Add User
              </button>
            </div>
          </div>

          {/* Location Form */}
          <div className="bg-white p-6 rounded-lg shadow-md">
            <h2 className="text-2xl font-semibold mb-4">Add New Location</h2>
            <div onSubmit={handleLocationSubmit} className="space-y-4">
              <input
                type="text"
                name="name"
                value={locationForm.name}
                onChange={handleLocationChange}
                placeholder="Location Name"
                className="w-full p-2 border rounded"
                required
              />
              <input
                type="text"
                name="address"
                value={locationForm.address}
                onChange={handleLocationChange}
                placeholder="Address"
                className="w-full p-2 border rounded"
                required
              />
              <div className="flex space-x-4">
                <input
                  type="number"
                  name="lat"
                  value={locationForm.coordinates.lat}
                  onChange={handleLocationChange}
                  placeholder="Latitude"
                  className="w-full p-2 border rounded"
                  step="any"
                />
                <input
                  type="number"
                  name="lng"
                  value={locationForm.coordinates.lng}
                  onChange={handleLocationChange}
                  placeholder="Longitude"
                  className="w-full p-2 border rounded"
                  step="any"
                />
              </div>
              <button
                onClick={handleLocationSubmit}
                className="w-full bg-green-500 text-white p-2 rounded hover:bg-green-600"
              >
                Add Location
              </button>
            </div>
          </div>

          {/* Users List */}
          <div className="bg-white p-6 rounded-lg shadow-md">
            <h2 className="text-2xl font-semibold mb-4">Users</h2>
            {users.length === 0 ? (
              <p>No users found.</p>
            ) : (
              <ul className="space-y-2">
                {users.map(user => (
                  <li key={user._id} className="border-b py-2">
                    <strong>{user.name}</strong> ({user.email})<br />
                    Phone: {user.phoneNumber || 'N/A'}<br />
                    Address: {user.address || 'N/A'}
                  </li>
                ))}
              </ul>
            )}
          </div>

          {/* Locations List */}
          <div className="bg-white p-6 rounded-lg shadow-md">
            <h2 className="text-2xl font-semibold mb-4">Locations</h2>
            {locations.length === 0 ? (
              <p>No locations found.</p>
            ) : (
              <ul className="space-y-2">
                {locations.map(location => (
                  <li key={location._id} className="border-b py-2">
                    <strong>{location.name}</strong><br />
                    Address: {location.address}<br />
                    Coordinates: {location.coordinates ? `${location.coordinates.lat}, ${location.coordinates.lng}` : 'N/A'}
                  </li>
                ))}
              </ul>
            )}
          </div>
        </div>
      );
    }

    // Render the app
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>